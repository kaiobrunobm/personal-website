"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = ftlToJs;
var _syntax = require("@fluent/syntax");
var _ftl2jsSerializer = _interopRequireDefault(require("./ftl2jsSerializer.js"));
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
function ftlToJs(str, cb) {
  var params = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {
    respectComments: true
  };
  if (typeof str !== 'string') {
    if (!cb) throw new Error('The first parameter was not a string');
    return cb(new Error('The first parameter was not a string'));
  }
  var parsed = (0, _syntax.parse)(str, {
    withSpans: false
  });
  var result = parsed.body.reduce(function (mem, segment) {
    var item = _ftl2jsSerializer.default.serialize(segment);
    if (!item) return mem;
    if (item.attributes && item.attributes.length || item.comment && params.respectComments) {
      var inner = {};
      if (item.comment) inner[item.comment.key] = item.comment.value;
      if (item.attributes && item.attributes.length) {
        item.attributes.forEach(function (attr) {
          inner[attr.key] = attr.value;
        });
      }
      inner.val = item.value;
      mem[item.key] = inner;
    } else {
      mem[item.key] = item.value;
    }
    return mem;
  }, {});
  if (cb) cb(null, result);
  return result;
}
module.exports = exports.default;